Public Sub SaveBillsAttachments(Item As Outlook.MailItem)
    Dim Atmt As Attachment
    Dim SaveFolder As String
    Dim FileName As String
    Dim SafeSubject As String
    Dim FilePath As String
    Dim i As Integer
    Dim newSubject As String
    Dim newMail As Outlook.MailItem

    MsgBox "Macro triggered for email: " & Item.Subject

    ' Determine folder based on subject keywords
    If InStr(Item.Subject, "160802728911") > 0 Then
        SaveFolder = "C:\Users\User01\Documents\MEGA\EDP\"
    ElseIf InStr(Item.Subject, "1277487") > 0 Then
        SaveFolder = "C:\Users\User01\Documents\MEGA\SIMAS\"
    ElseIf InStr(Item.Subject, "Fatura de pagamento App navegante") > 0 Then
        SaveFolder = "C:\Users\User01\Documents\MEGA\Metropolitano\"
    Else
        Exit Sub
    End If

    ' Create folder if it doesn't exist
    If Dir(SaveFolder, vbDirectory) = "" Then
        MkDir SaveFolder
    End If

    ' Sanitize subject to be filename-safe
    SafeSubject = Item.Subject
    SafeSubject = Replace(SafeSubject, "\", "-")
    SafeSubject = Replace(SafeSubject, "/", "-")
    SafeSubject = Replace(SafeSubject, ":", "-")
    SafeSubject = Replace(SafeSubject, "*", "-")
    SafeSubject = Replace(SafeSubject, "?", "-")
    SafeSubject = Replace(SafeSubject, """", "'")
    SafeSubject = Replace(SafeSubject, "<", "-")
    SafeSubject = Replace(SafeSubject, ">", "-")
    SafeSubject = Replace(SafeSubject, "|", "-")

    ' Save all PDF attachments with unique names
    i = 1
    For Each Atmt In Item.Attachments
        If LCase(Right(Atmt.FileName, 4)) = ".pdf" Then
            FileName = Format(Item.ReceivedTime, "mmyyyy") & i & ".pdf"
            FilePath = SaveFolder & FileName
            Atmt.SaveAsFile FilePath
            i = i + 1
        End If
    Next

    ' ? Send a confirmation email to danielpersilva@gmail.com
    Set newMail = Application.CreateItem(olMailItem)
    newMail.Subject = "[AutoDelete/1h] PDFs saved successfully"
    newMail.Body = "All PDF attachments from the email '" & Item.Subject & "' were saved successfully to:" & vbCrLf & SaveFolder
    newMail.To = "danielpersilva@gmail.com"
    newMail.Send

    ' Delete the original email
    Item.Delete

    MsgBox "All PDF attachments saved, confirmation sent, and original email deleted."
End Sub